TVODE Diagnostic Pipeline
=========================

Current Version: 2.1.1
Release Date: 2025-12-04

---

VERSION HISTORY

v2.1.1 (2025-12-04) - Thesis Evaluator Validation Fix
-----------------------------------------------------
COMPONENT: Evaluator (Thesis) v2.1

CHANGES:
- Restore component signals to API prompt (evidence_count, cause_effect_count, counter_signals)
- Add hard validation that checks extracted counts, not API labels
- Cap SM1 at 2.5 when evidence_count=0 (regardless of API's evidence_quality claim)
- Cap DCCEPS layer at 2 when cause_effect_count=0

RESULTS:
- Gabriel: 4.05 → 3.1 (correctly penalized for 0 evidence, 0 chains)
- Desmond: 3.75 → 3.55 (correctly scores higher than Gabriel)
- Coden: 4.05 → 4.05 (unchanged, has real substance)
- Order now reflects actual argument quality

ROOT CAUSE:
- Component extraction worked correctly
- API prompt was missing the extracted signals (implementation regression)
- API rewarded prose fluency over argument substance
- Validation checked API's label ("missing") not hard count (0)

KNOWN ISSUES:
- SM3 still rewards prose smoothness over argument structure (Issue 3 pending)
- No academic integrity flag for high-fluency/zero-substance pattern (Issue 2 pending)
- Minor: ceiling not fully enforced on SM2/SM3 when evidence_count=0


v2.1.0 (2025-12-04) - Transcription Accuracy Enhancement
--------------------------------------------------------
COMPONENT: Transcriber v2.1

CHANGES:
- Add Google Vision handwriting hint (en-t-i0-handwrit)
- Use paragraph structure for correct reading order (not spatial)
- Implement tiered routing based on OCR confidence:
  * Tier 1 (≥85%): Direct assembly, no Claude editing
  * Tier 2 (75-85%): Claude joining with validation
  * Tier 3 (<75%): Flag all for manual review
- Add validation check to prevent hallucination (word count, new words)
- Preserve kernel-based name normalization

RESULTS:
- Desmond: Fragments → Coherent (major improvement)
- Coden: Garbage → Readable (major improvement)
- No hallucination detected (validation passed)

KNOWN ISSUES:
- Strikethrough text still leaks through (future fix)


v2.0.0 (2025-12-03) - Google Vision Integration + Thesis API Evaluator
----------------------------------------------------------------------
COMPONENTS: Transcriber v2.0, Evaluator (Thesis) v2.0

TRANSCRIBER CHANGES:
- Replace Claude vision with Google Cloud Vision API for OCR
- Add kernel context injection for character/term normalization
- Add --kernel and --ocr-engine CLI arguments

TRANSCRIBER RESULTS:
- Reduced hallucination (no more "loving family" → "long body")
- Name normalization working (Jong → Jonas, Samness → Sameness)

THESIS EVALUATOR CHANGES:
- Hybrid architecture: rule-based extraction → API scoring
- Year-level relative scoring (Year 7-8 expects L2-3, not L4)
- Book context injection for charitable interpretation
- Word count ceiling enforcement
- DCCEPS layer assessment via API

THESIS EVALUATOR RESULTS:
- Position detection fixed (Gabriel correctly identified as "hero")
- Year 8 students not penalized for not reaching Layer 4
- Scoring differentiates students by actual reasoning quality

ISSUES IDENTIFIED:
- API not receiving extracted component signals (fixed in v2.1.1)
- Claude structuring step still edits/hallucinates (led to v2.1 transcriber)


v1.0.0 (2025-11-19) - Initial Release
-------------------------------------
ARCHITECTURE:
- Single-stage Claude vision transcription
- Claude Sonnet 4 model (claude-sonnet-4-20250514)
- Direct image-to-JSON conversion
- Rule-based thesis evaluator (regex pattern matching)

TRANSCRIBER FEATURES:
- Image transcription via Claude API vision
- Multi-page document support (--image page1.jpg page2.jpg)
- Structured JSON output with metadata
- Uncertainty detection with [UNCLEAR] markers
- Strikethrough detection (partial)
- Interactive review loop for uncertain words
- Handwriting quality assessment (clear/moderate/difficult)
- Accuracy score calculation (0.0-1.0)

THESIS EVALUATOR FEATURES:
- DCCEPS framework (Definition → Comparison → Cause-Effect → Problem-Solution)
- Position detection via regex patterns
- Evidence extraction (quotes, scene references)
- Reasoning chain detection (cause-effect, comparison patterns)
- Counter-argument and synthesis detection
- SM1/SM2/SM3 scoring parallel to TVODE

DATA STRUCTURES:
- TranscriptionResult dataclass
- ThesisComponents dataclass (position, evidence_items, reasoning_chains, etc.)
- ThesisEvaluationResult dataclass

KNOWN ISSUES:
- Claude hallucination on difficult handwriting
- Position detection fails on complex arguments (counter-argument confusion)
- Rule-based scoring doesn't understand semantic meaning

---

COMPONENTS

Transcriber: v2.1
Evaluator (Thesis): v2.1
Evaluator (TVODE): v1.0
Kernel Format: v4.0

---

CONFIGURATION

OCR Engine: Google Cloud Vision (default)
Fallback: Claude vision
Confidence Tiers: 85% / 75%
Validation: Word count ±10%, no new words >3

---

PENDING ISSUES

ISSUE_academic_integrity_flag.md (Priority: High)
- Detect high-fluency + zero-substance pattern
- Flag for teacher review, not auto-penalty

ISSUE_sm3_argument_structure.md (Priority: Medium)
- Redefine SM3 as argument structure, not prose fluency
- Add SM3 floor based on evidence/reasoning presence
